# Parking Bot

Телеграмм-бот для розыгрыша свободных парковочных мест в групповом чате.

## Установка

1. Установите зависимости:
```bash
make install
```

2. Скопируйте `.env.example` в `.env` и заполните переменные:
```bash
cp .env.example .env
```

3. Заполните в `.env`:
   
   **Обязательные параметры:**
   - `TELEGRAM_BOT_TOKEN` - токен вашего Telegram бота
   - `GIGACHAT_CLIENT_ID` - Client ID для GigaChat API
   - `GIGACHAT_CLIENT_SECRET` - Client Secret для GigaChat API
   - `OWNER_USER_ID` - ваш Telegram User ID (получить у [@userinfobot](https://t.me/userinfobot))
   - `ALLOWED_CHAT_IDS` - список ID разрешенных чатов через запятую (получить у [@getidsbot](https://t.me/getidsbot))
   
   **Настраиваемые параметры (опционально):**
   - `RAFFLE_TIMER_SECONDS` - время таймера розыгрыша в секундах (по умолчанию: 120 секунд = 2 минуты)
   - `MAX_ACTIVE_RAFFLES` - максимальное количество одновременных активных розыгрышей (по умолчанию: 5)

## Запуск

```bash
make run
```

## Тестирование

```bash
make test
```

## Особенности функционала

### Справедливое распределение мест

- **Ограничение для победителей**: Победитель одного розыгрыша не может участвовать в других активных розыгрышах (в рамках лимита 5 розыгрышей)
- **Исключение из параллельных розыгрышей**: Если пользователь участвует в нескольких розыгрышах одновременно и выигрывает в одном, он автоматически исключается из выбора победителя в других
- **Очистка по дням**: Розыгрыши автоматически удаляются из памяти при смене дня, обеспечивая справедливое распределение мест каждый день

### Информативность

- **Таймер обратного отсчета**: Сообщение показывает оставшееся время до завершения розыгрыша (обновляется каждые 10 секунд)
- **Счетчик участников**: На кнопке отображается количество участников в реальном времени
- **Визуальные индикаторы**: Эмодзи делают интерфейс более понятным и дружелюбным

### Управление памятью

- **Лимит активных розыгрышей**: Одновременно может быть не более 5 активных розыгрышей
- **Автоматическая очистка**: При превышении лимита удаляется самый старый розыгрыш
- **Удаление сообщений**: После завершения розыгрыша сообщение автоматически удаляется из чата

## Безопасность

Бот защищен от несанкционированного использования:
- Работает только в разрешенных чатах (whitelist)
- Блокирует личные сообщения
- Контролирует добавление в группы (только владелец может добавлять)

Подробнее: [Документация по безопасности](docs/security.md)

## Конфигурация

Подробная информация о настройке параметров бота: [Документация по конфигурации](docs/configuration.md)

## Документация

- [Идея проекта](docs/idea.md)
- [Техническое видение](docs/vision.md)
- [Правила разработки](docs/conventions.md)
- [План разработки](docs/tasklist.md)
- [Безопасность](docs/security.md)
- [Конфигурация](docs/configuration.md)
- [История изменений](CHANGELOG.md)
